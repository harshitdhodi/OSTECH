import{r as i,E as K,s as X,b as u,j as t}from"./index-Bf0_iwmC.js";import{R as $}from"./quill.snow-N0L4fiYi.js";const W=()=>{const[r,v]=i.useState({title:"",details:"",photo:[],slug:"",homeDetail:"",metatitle:"",metadescription:"",metakeywords:"",metalanguage:"",metacanonical:"",metaschema:"",otherMeta:"",status:"active",parentCategoryId:"",subCategoryId:"",subSubCategoryId:"",url:"",changeFreq:"",priority:"",benefits:[],catalogue:"",keyFeatures:[],isVisible:!0}),[E,T]=i.useState([]),[Q,M]=i.useState([]),[w,C]=i.useState([]),[m,b]=i.useState([]),[h,g]=i.useState([]),[f,y]=i.useState([]),[x,j]=i.useState([]),[N,k]=i.useState([]),{slugs:p}=K(),V=X(),n=(a,e)=>{v(l=>({...l,[a]:e}))},F=i.useCallback(async()=>{var a,e,l;try{const s=(await u.get(`/api/product/getSingleProduct?slugs=${p}`,{withCredentials:!0})).data,c=((e=(a=s.categories)==null?void 0:a[0])==null?void 0:e._id)||"";v(d=>{var S,D;return{...d,title:s.title,details:s.details,homeDetail:s.homeDetail,status:s.status,slug:s.slug,keyFeatures:s.keyFeature||[],metatitle:s.metatitle,metadescription:s.metadescription,metakeywords:s.metakeywords,metalanguage:s.metalanguage,metacanonical:s.metacanonical,metaschema:s.metaschema,otherMeta:s.otherMeta,benefits:s.benefits,url:s.url||`http://localhost:3000/product/${s.slug}`,changeFreq:s.changeFreq,priority:s.priority,catalogue:s.catalogue,parentCategoryId:c,subCategoryId:((S=s.subcategories)==null?void 0:S[0])||"",subSubCategoryId:((D=s.subSubcategories)==null?void 0:D[0])||"",isVisible:s.isVisible}}),C(s.photo||[]),y(s.alt||[]),j(Array.isArray(s.imgtitle)?s.imgtitle:((l=s.photo)==null?void 0:l.map(()=>""))||[])}catch(o){console.error("Error fetching product:",o)}},[p]),P=i.useCallback(async()=>{try{const a=await u.get("/api/product/getAll",{withCredentials:!0});T(a.data)}catch(a){console.error("Error fetching categories:",a)}},[]),A=i.useCallback(async()=>{try{const a=await u.get("/api/benefits/getBenefits",{withCredentials:!0});M(a.data)}catch(a){console.error("Error fetching benefits:",a)}},[]);i.useEffect(()=>{Promise.all([F(),P(),A()])},[F,P,A]),i.useEffect(()=>{if(r.title){const a=r.title.replace(/\s+/g,"-").toLowerCase();n("slug",a),n("url",`http://localhost:3000/product/${a}`)}},[r.title]);const q=async a=>{a.preventDefault();try{const e=new FormData;Object.entries(r).forEach(([o,s])=>{o!=="photo"&&s!==null&&s!==void 0&&(Array.isArray(s)?s.forEach(c=>e.append(o,c)):e.append(o,s))}),w.forEach((o,s)=>{e.append("photo",o),e.append("alt[]",f[s]||""),e.append("imgtitle[]",x[s]||"")}),N.length>0&&N.forEach((o,s)=>{e.append("photo",o),e.append("alt[]",m[s]||""),e.append("imgtitle[]",h[s]||"")});for(let o of e.entries())console.log(o[0],o[1]);(await u.put(`/api/product/updateProduct?slugs=${p}`,e,{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0})).status===200&&(console.log("Product updated successfully"),V("/product"))}catch(e){console.error("Error updating product:",e)}},R=a=>{const e=Array.from(a.target.files);k(l=>{const o=[...l,...e];m.length;const s=Array(e.length).fill("");b(d=>[...d,...s]),h.length;const c=Array(e.length).fill("");return g(d=>[...d,...c]),o})},_=(a,e)=>{const l=[...f];l[e]=a.target.value,y(l)},B=(a,e)=>{const l=[...m];l[e]=a.target.value,b(l)},L=(a,e)=>{const l=[...x];l[e]=a.target.value,j(l)},U=(a,e)=>{const l=[...h];l[e]=a.target.value,g(l)},O=async(a,e,l)=>{a.preventDefault();try{const o=await u.delete(`/api/product/${p}/image/${e}/${l}`,{withCredentials:!0});o.status===200?(C(o.data.remainingPhotos),y(o.data.remainingAlts),j(o.data.remainingTitles)):console.error("Failed to delete photo:",o.data.message)}catch(o){console.error("Error deleting photo:",o)}},z=(a,e)=>{a.preventDefault(),k(l=>l.filter((o,s)=>s!==e)),b(l=>l.filter((o,s)=>s!==e)),g(l=>l.filter((o,s)=>s!==e))},H=a=>{const e=a.target.value;n("parentCategoryId",e),n("subCategoryId",""),n("subSubCategoryId","")},I={toolbar:[[{font:[]}],["bold","italic","underline","strike","blockquote"],[{header:[1,2,3,4,5,6,!1]}],[{list:"ordered"},{list:"bullet"},{list:"check"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],["link","image","video"],[{direction:"rtl"}],[{color:[]},{background:[]}],[{align:[]}],["clean"]],clipboard:{matchVisual:!1}};return t.jsxs("form",{onSubmit:q,className:"p-4",children:[t.jsx("h1",{className:"text-xl font-bold font-serif text-gray-700 uppercase text-center",children:"Edit Product"}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"parentCategory",className:"block font-semibold mb-2",children:"Parent Category"}),t.jsxs("select",{id:"parentCategory",value:r.parentCategoryId,onChange:H,className:"w-full p-2 border rounded focus:outline-none",required:!0,children:[t.jsx("option",{value:"",children:"Select Parent Category"}),E.map(a=>t.jsx("option",{value:a._id,selected:a._id===r.parentCategoryId,children:a.category},a._id))]})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"title",className:"block font-semibold mb-2",children:"Title"}),t.jsx("input",{id:"title",type:"text",value:r.title,onChange:a=>n("title",a.target.value),className:"w-full p-2 border rounded focus:outline-none",required:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"details",className:"block font-semibold mb-2",children:"Description"}),t.jsx($,{id:"details",value:r.details,onChange:a=>n("details",a),modules:I,className:"border rounded focus:outline-none"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"homeDetail",className:"block font-semibold mb-2",children:"Home Detail"}),t.jsx($,{id:"homeDetail",value:r.homeDetail,onChange:a=>n("homeDetail",a),modules:I,className:"border rounded focus:outline-none"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block font-semibold mb-2",children:"Current Photos"}),t.jsx("div",{className:"flex flex-wrap gap-4",children:w.map((a,e)=>t.jsxs("div",{className:"relative w-56",children:[t.jsx("img",{src:`/api/image/download/${a}`,alt:`Photo ${e+1}`,className:"w-56 h-32 object-cover"}),t.jsxs("label",{htmlFor:`alt-${e}`,className:"block mt-2",children:["Alternative Text:",t.jsx("input",{type:"text",id:`alt-${e}`,value:f[e]||"",onChange:l=>_(l,e),className:"w-full p-2 border rounded focus:outline-none"})]}),t.jsxs("label",{htmlFor:`imgtitle-${e}`,className:"block mt-2",children:["Image Title:",t.jsx("input",{type:"text",id:`imgtitle-${e}`,value:x[e]||"",onChange:l=>L(l,e),className:"w-full p-2 border rounded focus:outline-none"})]}),t.jsx("button",{onClick:l=>O(l,a,e),className:"absolute top-4 right-2 bg-red-500 text-white rounded-md p-1 size-6 flex justify-center items-center",children:t.jsx("span",{className:"text-xs",children:"X"})})]},e))})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block font-semibold mb-2",children:"Add New Photos"}),t.jsx("input",{type:"file",onChange:R,multiple:!0,accept:"image/*",className:"p-2 border rounded"}),t.jsx("div",{className:"flex flex-wrap gap-4 mt-4",children:N.map((a,e)=>t.jsxs("div",{className:"relative w-56",children:[t.jsx("img",{src:URL.createObjectURL(a),alt:`New Photo ${e+1}`,className:"w-56 h-32 object-cover"}),t.jsxs("label",{htmlFor:`alt-new-${e}`,className:"block mt-2",children:["Alternative Text:",t.jsx("input",{type:"text",id:`alt-new-${e}`,value:m[e]||"",onChange:l=>B(l,e),className:"w-full p-2 border rounded focus:outline-none"})]}),t.jsxs("label",{htmlFor:`imgtitle-new-${e}`,className:"block mt-2",children:["Image Title:",t.jsx("input",{type:"text",id:`imgtitle-new-${e}`,value:h[e]||"",onChange:l=>U(l,e),className:"w-full p-2 border rounded focus:outline-none"})]}),t.jsx("button",{onClick:l=>z(l,e),className:"absolute top-4 right-2 bg-red-500 text-white rounded-md p-1 size-6 flex justify-center items-center",children:t.jsx("span",{className:"text-xs",children:"X"})})]},e))})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"block font-semibold mb-2",children:"Key Features"}),t.jsxs("div",{className:"space-y-2",children:[r.keyFeatures.map((a,e)=>t.jsxs("div",{className:"flex gap-2",children:[t.jsx("input",{type:"text",value:a,onChange:l=>{const o=[...r.keyFeatures];o[e]=l.target.value,n("keyFeatures",o)},className:"flex-1 p-2 border rounded focus:outline-none",placeholder:"Enter feature"}),t.jsx("button",{type:"button",onClick:()=>{const l=r.keyFeatures.filter((o,s)=>s!==e);n("keyFeatures",l)},className:"bg-red-500 text-white px-3 py-2 rounded hover:bg-red-600",children:"Remove"})]},e)),t.jsx("button",{type:"button",onClick:()=>n("keyFeatures",[...r.keyFeatures,""]),className:"bg-green-500 text-white px-3 py-2 rounded hover:bg-green-600",children:"Add Feature"})]})]}),t.jsx("div",{className:"space-y-4",children:[{label:"Meta Title",key:"metatitle"},{label:"Meta Description",key:"metadescription"},{label:"Meta Keywords",key:"metakeywords"},{label:"Meta Canonical",key:"metacanonical"},{label:"Meta Language",key:"metalanguage"},{label:"Other Meta",key:"otherMeta"},{label:"Schema",key:"metaschema"}].map(({label:a,key:e})=>t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:e,className:"block font-semibold mb-2",children:a}),t.jsx("textarea",{id:e,value:r[e],onChange:l=>n(e,l.target.value),className:"w-full p-2 border rounded focus:outline-none",rows:"3"})]},e))}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"priority",className:"block font-semibold mb-2",children:"Priority"}),t.jsx("input",{type:"number",id:"priority",min:0,max:1,step:.1,value:r.priority,onChange:a=>n("priority",a.target.value),className:"w-full p-2 border rounded focus:outline-none"})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"changeFreq",className:"block font-semibold mb-2",children:"Change Frequency"}),t.jsxs("select",{id:"changeFreq",value:r.changeFreq,onChange:a=>n("changeFreq",a.target.value),className:"w-full p-2 border rounded focus:outline-none",children:[t.jsx("option",{value:"",children:"Select Change Frequency"}),["always","hourly","daily","weekly","monthly","yearly"].map(a=>t.jsx("option",{value:a,children:a.charAt(0).toUpperCase()+a.slice(1)},a))]})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"status",className:"block font-semibold mb-2",children:"Status"}),t.jsxs("select",{id:"status",value:r.status,onChange:a=>n("status",a.target.value),className:"w-full p-2 border rounded focus:outline-none",children:[t.jsx("option",{value:"popular",children:"Popular"}),t.jsx("option",{value:"normal",children:"Normal"})]})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{htmlFor:"isVisible",className:"block font-semibold mb-2",children:"Visibility"}),t.jsxs("select",{id:"isVisible",value:r.isVisible,onChange:a=>n("isVisible",a.target.value==="true"),className:"w-full p-2 border rounded focus:outline-none",children:[t.jsx("option",{value:"true",children:"Visible"}),t.jsx("option",{value:"false",children:"Hidden"})]})]}),t.jsx("button",{type:"submit",className:"bg-blue-500 hover:bg-blue-600 text-white py-2 px-4 rounded focus:outline-none",children:"Update Product"})]})};export{W as default};
